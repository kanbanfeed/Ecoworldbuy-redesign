<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> | EcoWorldBuy</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="/styles.css">

    <style>
        #crowbar-access-bar {
            background-color: #064e3b; color: #ecfdf5; text-align: center;
            font-size: 0.75rem; padding: 12px 0; font-weight: 700; letter-spacing: 1.5px;
            text-transform: uppercase; display: none; border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .access-icon { margin-right: 8px; color: #34d399; font-size: 0.9rem; }
        
        /* Toggle Visibility Classes */
        .auth-hidden { display: none !important; }
        .auth-visible { display: inline-block !important; }
    </style>
</head>
<body>

    <div id="crowbar-access-bar">
        <i class="bi bi-shield-fill-check access-icon"></i> 
        Access Granted: Crowbar Membership Active
    </div>

    <div class="announcement-bar" style="text-align: center;">
        Free Carbon-Neutral Shipping on Orders Over $50
    </div>

   <nav class="navbar">
    <div class="container nav-container">
        <div style="display: flex; align-items: center; gap: 30px;">
            <a href="/" class="nav-brand">
                <i class="bi bi-bag-fill" style="color: #F4A226;"></i> EcoWorld.
            </a>
            <div class="header-links">
                <a href="/">Home</a>
                <a href="/shop">Products</a>
            </div>
        </div>
 <button class="nav-toggle" type="button" aria-label="Open menu" aria-expanded="false">â˜°</button>

            <div class="nav-search">
            <input type="text" placeholder="Search in products...">
            <button>Search</button>
        </div>


            <div class="nav-icons">
            <a href="/cart" class="cart-icon">
                <i class="bi bi-cart3"></i>
                <span class="cart-count"><%= typeof cartCount !== 'undefined' ? cartCount : 0 %></span>
            </a>
                
                 <a href="/login" id="btn-login-nav">
                <i class="bi bi-person-circle"></i> Login
            </a>

            <a href="#" id="btn-logout-nav" class="auth-hidden" onclick="logout()">
                <i class="bi bi-box-arrow-right"></i> Logout
            </a>
            </div>
        </div>

        <div class="mobile-nav" aria-hidden="true">
        <!-- top links -->
        <a class="mobile-item" href="/">Home</a>
        <a class="mobile-item" href="/shop">Products</a>

        <!-- mobile search -->
        <div class="mobile-search">
            <input type="text" placeholder="Search products...">
            <button type="button">Search</button>
        </div>

        <!-- auth row -->
        <a class="mobile-item" id="mobile-login" href="/login">Login</a>
        <a class="mobile-item auth-hidden" id="mobile-logout" href="#" onclick="logout()">Logout</a>
    </div>
    </nav>

    <%- body %>

    <footer>
        <div class="container">
            <h3>EcoWorldBuy.</h3>
            <p>Premium Retail & Lifestyle.</p>
            <small>&copy; 2025 Crowbar Ecosystem</small>
        </div>
    </footer>

    <script>
        // 1. Check Login Status
        const session = localStorage.getItem('crowbar_session');
        const currentPath = window.location.pathname;
        
        const loginBtn = document.getElementById('btn-login-nav');
        const logoutBtn = document.getElementById('btn-logout-nav');
        const banner = document.getElementById('crowbar-access-bar');

        if (session) {
            // USER IS LOGGED IN
            if (loginBtn) loginBtn.classList.add('auth-hidden');   // Hide Login
            if (logoutBtn) logoutBtn.classList.remove('auth-hidden'); // Show Logout
            
            // Show Banner (if not on login page)
            if (banner && currentPath !== '/login') {
                banner.style.display = 'block';
            }
        } else {
            // USER IS LOGGED OUT
            if (loginBtn) loginBtn.classList.remove('auth-hidden');
            if (logoutBtn) logoutBtn.classList.add('auth-hidden');
        }

        // 2. Logout Function
        function logout() {
            // Clear the session keys
            localStorage.removeItem('crowbar_session');
            localStorage.removeItem('crowbar_user');
            
            // Refresh to update UI
            window.location.href = '/';
        }
    </script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const navToggle = document.querySelector('.nav-toggle');
    const mobileNav = document.querySelector('.mobile-nav');

    const loginBtn = document.getElementById('btn-login-nav');
    const logoutBtn = document.getElementById('btn-logout-nav');
    const mobileLogin = document.getElementById('mobile-login');
    const mobileLogout = document.getElementById('mobile-logout');

    // toggle mobile panel
    if (navToggle && mobileNav) {
      navToggle.addEventListener('click', function(e) {
        const shown = mobileNav.classList.toggle('_show');
        navToggle.setAttribute('aria-expanded', shown ? 'true' : 'false');
        mobileNav.setAttribute('aria-hidden', shown ? 'false' : 'true');
      });

      // click outside to close
      document.addEventListener('click', (e) => {
        if (!mobileNav.contains(e.target) && !navToggle.contains(e.target)) {
          mobileNav.classList.remove('_show');
          navToggle.setAttribute('aria-expanded', 'false');
          mobileNav.setAttribute('aria-hidden', 'true');
        }
      });

      // prevent closing when clicking inside panel
      mobileNav.addEventListener('click', (e) => e.stopPropagation());
    }

    // Mirror auth visibility in mobile panel
    function syncAuth() {
      const session = localStorage.getItem('crowbar_session');
      if (session) {
        if (loginBtn) loginBtn.classList.add('auth-hidden');
        if (logoutBtn) logoutBtn.classList.remove('auth-hidden');
        if (mobileLogin) mobileLogin.classList.add('auth-hidden');
        if (mobileLogout) mobileLogout.classList.remove('auth-hidden');
        // show crowbar banner if present
        const banner = document.getElementById('crowbar-access-bar');
        if (banner && window.location.pathname !== '/login') banner.style.display = 'block';
      } else {
        if (loginBtn) loginBtn.classList.remove('auth-hidden');
        if (logoutBtn) logoutBtn.classList.add('auth-hidden');
        if (mobileLogin) mobileLogin.classList.remove('auth-hidden');
        if (mobileLogout) mobileLogout.classList.add('auth-hidden');
      }
    }

    // initial sync
    syncAuth();

    // optionally listen for storage events (if login occurs in another tab)
    window.addEventListener('storage', function(e) {
      if (e.key === 'crowbar_session' || e.key === 'crowbar_user') syncAuth();
    });
  });
</script>

</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> | EcoWorldBuy</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="/styles.css">
</head>
<body>

    <div class="promo-bar">
        Free carbon-neutral shipping on orders $50+ · Crowbar members earn 2× credits today
    </div>

    <nav class="navbar">
        <div class="nav-container">
            <a href="/" class="nav-brand">
                <i class="bi bi-flower1"></i> EcoWorldBuy
            </a>

            <ul class="nav-links">
                <li><a href="/" class="nav-link">Home</a></li>
                <li><a href="/shop" class="nav-link">New Arrivals</a></li>
               
                
                <li><a href="/cart" class="nav-link">My Bag</a></li>
            </ul>

            <div class="nav-actions">
                <div class="search-bar">
                    <i class="bi bi-search" style="color:#aaa; margin-right:8px;"></i>
                    <input type="text" placeholder="Search products...">
                </div>

                <a href="/cart" class="icon-btn">
                    <i class="bi bi-bag"></i>
                    <span class="cart-badge"><%= typeof cartCount !== 'undefined' ? cartCount : 0 %></span>
                </a>

       <a href="/login" class="btn-crowbar-login" id="nav-login-btn">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="margin-top:-2px;">
        <path d="M2 4l3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/>
    </svg>
    Login with Crowbar
</a>            
                <button class="nav-toggle"><i class="bi bi-list"></i></button>
            </div>
        </div>
    </nav>

    <div class="mobile-menu">
        <button class="close-menu">×</button>
        <a href="/" class="mobile-link">Home</a>
        <a href="/shop" class="mobile-link">Shop All</a>
        <a href="/shop" class="mobile-link">Home</a>
        <a href="/shop" class="mobile-link">Travel</a>
        <a href="/cart" class="mobile-link">Cart (<%= typeof cartCount !== 'undefined' ? cartCount : 0 %>)</a>
        <a href="/login" class="btn-crowbar" id="mobile-login-btn">Login with Crowbar</a>
    </div>

    <%- body %>

    <footer class="site-footer">
        <div class="home-shell footer-main">
            <div class="footer-brand">
                <div class="footer-logo">EcoWorldBuy</div>
                <p>Smart eco-commerce, transparent pricing.</p>
            </div>
            <div class="footer-network">
                <span>Part of the <i class="bi bi-crown-fill"></i> Crowbar Connected Network</span>
                <span>© <%= new Date().getFullYear() %> EcoWorldBuy. All rights reserved.</span>
            </div>
        </div>
    </footer>

   <script>
    // 1. Mobile Menu Logic
    const navToggle = document.querySelector('.nav-toggle');
    const mobileMenu = document.querySelector('.mobile-menu');
    const closeMenu = document.querySelector('.close-menu');

    if(navToggle) {
        navToggle.addEventListener('click', () => mobileMenu.classList.add('open'));
        closeMenu.addEventListener('click', () => mobileMenu.classList.remove('open'));
    }

    // 2. Auth State Checker (Crowbar)
    const session = localStorage.getItem('crowbar_session');
    const loginBtn = document.getElementById('nav-login-btn');
    const mobileBtn = document.getElementById('mobile-login-btn');

    // LOGOUT FUNCTION
    function logout(e) {
        if(e) e.preventDefault();
        localStorage.removeItem('crowbar_session');
        localStorage.removeItem('crowbar_user');
        window.location.href = '/logout';
    }

    // UPDATE UI IF LOGGED IN
    if (session) {
        // Update Desktop Button
        if (loginBtn) {
            // Change class to the Dark Logout Style
            loginBtn.className = 'btn-crowbar-logout'; 
            // Change Text and Icon
            loginBtn.innerHTML = '<i class="bi bi-box-arrow-right"></i> Logout';
            loginBtn.href = '#'; 
            loginBtn.onclick = logout;
        }

        // Update Mobile Button
        if (mobileBtn) {
            mobileBtn.innerHTML = 'Logout';
            mobileBtn.href = '#';
            mobileBtn.onclick = logout;
        }
    }

    // 3. SCROLL ANIMATION OBSERVER
    const observerOptions = { threshold: 0.1 };
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
                observer.unobserve(entry.target);
            }
        });
    }, observerOptions);

    document.querySelectorAll('.fade-in-up').forEach(el => observer.observe(el));
</script>
</body>
</html>